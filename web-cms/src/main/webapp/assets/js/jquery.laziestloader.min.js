(function(e){typeof define=="function"&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){var t=function(n,r){function f(t){var r,i,s=t.data();if(s.pattern&&s.widths&&e.isArray(s.widths)){r=u?s.patternRetina:s.pattern;r=r||s.pattern;if(typeof s.widths[0]=="object"){i=function(){var n=e.map(s.widths,function(e,t){return e.size}),r=h(t.width(),n);for(var i=s.widths.length-1;i>=0;i--)if(s.widths[i].size===r)return s.widths[i].slug}();r=r.replace(n.sizePattern,i)}else r=r.replace(n.sizePattern,h(t.width(),s.widths))}else{r=u?s.srcRetina:s.src;r=r||s.src}return r}function l(){s.one("laziestloader",function(){var t;e(this).data().ratio&&d.call(this);if(n.setSourceMode){t=n.getSource(e(this));if(t&&this.getAttribute("src")!==t){this.setAttribute("src",t);typeof r=="function"&&r.call(this)}}else typeof r=="function"&&r.call(this)})}function c(){s.off("laziestloader")}function p(){var t=s.not(o).filter(function(){var t=e(this),r=n.threshold;if(t.is(":hidden"))return;var s=i.scrollTop(),o=s+i.height(),u=t.offset().top,a=u+t.height();return a>=s-r&&u<=o+r});t.trigger("laziestloader");o.add(t)}function d(){var t=e(this),n=t.data();n.ratio=n.ratio||n.heightMultiplier;n.ratio&&t.css({height:Math.round(t.width()*n.ratio)})}var i=e(window),s=this,o=e(),u=window.devicePixelRatio>1,a=!1;n=e.extend(!0,{threshold:0,sizePattern:/{{SIZE}}/ig,getSource:f,scrollThrottle:250,sizeOffsetPercent:0,setSourceMode:!0},n);var h=t.bestFit=function(e,t){var r=t[t.length-1],i=t.length,s=e*(n.sizeOffsetPercent/100);t.sort(function(e,t){return e-t});while(i--)e-s<=t[i]&&(r=t[i]);return r};s.each(d);l();i.scroll(function(){a=!0});setInterval(function(){if(a){a=!1;p()}},n.scrollThrottle);i.resize(function(){o=e();c();l();p()});p();return this};e.fn.laziestloader=t});