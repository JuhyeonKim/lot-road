<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nagesoft.postcode.member.dao.RoleDAO">
	<resultMap type="com.nagesoft.postcode.member.model.Role" id="roleResult">
		<id 	    property="sequence" 				column="SEQ"     />
		<result 	property="user.id" 					column="USR_ID"     />
		<result 	property="roleType" 				column="AUTH_NM"  typeHandler="com.nagesoft.postcode.member.model.handler.RoleTypeEnumHandler" />
		<result 	property="regUser.id" 				column="REG_USR_ID"     />
		<result 	property="modUser.id" 				column="MOD_USR_ID"     />
		<result 	property="regDate" 					column="REG_DT"     />
		<result 	property="modDate" 					column="MOD_DT"   />
	</resultMap>

	<insert id="insert" parameterType="com.nagesoft.postcode.member.model.Role" >
        INSERT INTO GC_USR_ROLE
        (
        USR_ID
        ,AUTH_NM
        ,REG_USR_ID
        ,REG_DT
        )
        VALUES
        (
        #{user.sequence }
        ,#{roleType.code }
        ,#{regUser.sequence }
        ,NOW()
        )
        <selectKey keyProperty="sequence" order="AFTER" resultType="java.lang.Long">
		    SELECT LAST_INSERT_ID()
		</selectKey>
	</insert>

	<delete id="delete" parameterType="java.lang.Long">
		DELETE
		FROM GC_USR_ROLE
		WHERE SEQ = #{sequence }
	</delete>

	<delete id="deleteByParent" parameterType="com.nagesoft.postcode.member.model.User">
		DELETE
		FROM GC_USR_ROLE
		WHERE USR_ID = #{id }
	</delete>
</mapper>